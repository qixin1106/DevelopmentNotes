# 二维码登录流程

### 技术优势

二维码登录的优势在于它可以提供更快捷的登录方式，无需输入用户名和密码，只需要扫描二维码即可完成登录。此外，二维码登录还可以提高安全性，因为它可以避免用户输入错误的密码或用户名，从而避免了密码泄露的风险。

### 自说

微信是国内比较早实用二维码登录桌面端的产品,恰巧我之前的项目也要用到这个技术.下面介绍一下我们的二维码登录的流程.

### 流程

① **桌面端**请求服务器生成二维码
> UUID : 本地生成一个唯一的标识,可以看成是本地二维码登录流程的一个任务id,想服务器发起二维码生成请求

② **桌面端**获取二维码并展示
> 服务器端维护UUID和二维码的关系绑定,即哪个用户扫描了该二维码,即可更新该二维码对应UUID轮询接口的状态.

> 轮询的时间是有超时的,你可以根据需要自己设计,超时之后中断登录流程,并更新UI告知.

> 用户如需重新开启流程,我们提供了"刷新"按钮.

③ **桌面端**轮询请求二维码登录状态
> 通过UUID来查询

> 调用查询接口时,可以上传当前桌面端的一些基本信息,比如平台,设备等,这个是根据业务自定义的,非强制.

④ **移动端**扫码,通过二维码的地址进行接口访问
> 接口访问时,通常会带上移动端用户的身份信息,让服务器端知道是哪个用户进行了扫码

⑤ **桌面端**轮询接口的结果发生状态变化.
> 比如读取一个statusCode,变为被扫码状态,此接口还可以同时返回扫码用户的身份基本数据,比如头像,昵称,uid等等.此时为待登录状态.

> 通常等待手机端登录操作时,要加上超时判断,可以定一个Timer倒计时.

⑥ **移动端**扫码成功后.移动端显示确认登录UI.
> 通常提供"确定"或者"取消",以及设备信息等等

> 设备信息是由③步桌面端上传的.比如你可以显示,它的平台,机型等等.

⑦ **移动端**选择登录/取消
> 发送不同的HTTP请求,服务器端收到请求后,会对应改变轮询接口的状态值

⑧ **桌面端**轮询接口的结果发生状态码变化,告知是取消/登录成功.
> 如果登录成功状态下,轮询接口会顺便返回,生成的token,和用户信息等等.

### 总结

该方案比较成熟,而且也适用于网站登录.就是现在我觉得打开手机扫码这个操作有点麻烦.因为现在macOS都有iCloud密码,反而输入密码更方便一些,但是考虑到在一些非自己的设备上登录,显然二维码登录更加安全.

### 后

下一篇可能打算记录一些桌面客户端支持网页sso登录的流程.