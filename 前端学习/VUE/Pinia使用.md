# PiniağŸä½¿ç”¨

[Pinia](https://pinia.vuejs.org) æ˜¯ä¸€ä¸ªç”¨äº Vue.js çš„çŠ¶æ€ç®¡ç†åº“ã€‚å®ƒæ˜¯ Vuex çš„ä¸€ä¸ªè½»é‡çº§æ›¿ä»£å“ï¼Œä¸“ä¸º Vue 3 è®¾è®¡ï¼Œä½†ä¹Ÿå¯ä»¥åœ¨ Vue 2 ä¸­ä½¿ç”¨ã€‚Pinia æä¾›äº†ä¸€ç§ç®€å•ä¸”çµæ´»çš„æ–¹å¼æ¥ç®¡ç†å’Œç»„ç»‡ä½ çš„åº”ç”¨çŠ¶æ€ã€‚

## åœ¨ Vue3 é¡¹ç›®ä¸­ä½¿ç”¨ Pinia ä½œä¸ºçŠ¶æ€ç®¡ç†å·¥å…·æœ‰ä»¥ä¸‹ä¸€äº›ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š

**ä¼˜ç‚¹**ï¼š

1. **ç®€å•æ˜“ç”¨**ï¼šPinia çš„ API è®¾è®¡å¾—éå¸¸ç®€å•ï¼Œæ˜“äºç†è§£å’Œä½¿ç”¨ã€‚å®ƒæä¾›äº†ä¸€ç§æ›´ç›´è§‚çš„æ–¹å¼æ¥å®šä¹‰å’Œç®¡ç†çŠ¶æ€ï¼Œä½¿å¾—ä»£ç æ›´æ˜“äºé˜…è¯»å’Œç»´æŠ¤ã€‚

2. **çµæ´»æ€§**ï¼šPinia å…è®¸ä½ æ ¹æ®éœ€è¦åˆ›å»ºä»»æ„æ•°é‡çš„ storeï¼Œè¿™ä½¿å¾—çŠ¶æ€ç®¡ç†æ›´åŠ çµæ´»ã€‚

3. **æ›´å¥½çš„ TypeScript æ”¯æŒ**ï¼šPinia æä¾›äº†å‡ºè‰²çš„ TypeScript æ”¯æŒï¼Œè¿™å¯¹äº TypeScript é¡¹ç›®æ¥è¯´æ˜¯ä¸€ä¸ªå·¨å¤§çš„ä¼˜åŠ¿ã€‚

4. **è‡ªåŠ¨åŒ–çš„ä»£ç æ‹†åˆ†**ï¼šPinia æ”¯æŒè‡ªåŠ¨åŒ–çš„ä»£ç æ‹†åˆ†ï¼Œè¿™å¯ä»¥å¸®åŠ©æé«˜åº”ç”¨çš„æ€§èƒ½ã€‚

**ç¼ºç‚¹**ï¼š

1. **æ–°çš„å­¦ä¹ æ›²çº¿**ï¼šå°½ç®¡ Pinia çš„ API è®¾è®¡å¾—ç›¸å½“ç®€å•ï¼Œä½†å¯¹äºä¹ æƒ¯äº† Vuex çš„å¼€å‘è€…æ¥è¯´ï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´æ¥é€‚åº”ã€‚

2. **ç¤¾åŒºæ”¯æŒ**ï¼šè™½ç„¶ Pinia æ˜¯ç”± Vue.js çš„æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜å¼€å‘çš„ï¼Œä½†å®ƒç›¸å¯¹äº Vuex æ¥è¯´è¿˜æ˜¯è¾ƒæ–°çš„åº“ï¼Œå› æ­¤å¯èƒ½åœ¨ç¤¾åŒºæ”¯æŒå’Œå¯ç”¨èµ„æºæ–¹é¢ç¨é€Šä¸€ç­¹ã€‚

3. **å¯èƒ½çš„ä¸ç¨³å®šæ€§**ï¼šç”±äº Pinia æ˜¯ä¸€ä¸ªç›¸å¯¹è¾ƒæ–°çš„åº“ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›å°šæœªå‘ç°çš„é—®é¢˜æˆ–è€…ä¸ç¨³å®šçš„åœ°æ–¹ã€‚

## ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨ Vue é¡¹ç›®ä¸­ä½¿ç”¨ Pinia çš„åŸºæœ¬æ­¥éª¤ï¼š

1. **å®‰è£… Pinia**ï¼šä½ å¯ä»¥ä½¿ç”¨ `npm` æˆ– `yarn` æ¥å®‰è£… Piniaã€‚åœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
   
   ```bash
   npm install pinia
   # æˆ–è€…
   yarn add pinia
   ```

2. **åˆ›å»ºå¹¶ä½¿ç”¨ Pinia store**ï¼šåœ¨ä½ çš„ `main.js` æˆ– `main.ts` æ–‡ä»¶ä¸­ï¼Œéœ€è¦ä½ åˆ›å»ºçš„ Pinia storeã€‚ä¾‹å¦‚ï¼š
   
   ```ts
   import { createApp } from 'vue'
   import App from './App.vue'
   // å¯¼å…¥pinia
   import { createPinia } from 'pinia'
   // åˆ›å»ºapp
   const app = createApp(App)
   // åˆ›å»ºpinia
   const pinia = createPinia()
   // ä½¿ç”¨pinia
   app.use(pinia)
   // æŒ‚è½½app
   app.mount('#app')
   ```

3. **åˆ›å»ºstoreæ–‡ä»¶**ï¼šåœ¨ä½ çš„ `src` ç›®å½•ä¸‹åˆ›å»º `store` ç›®å½•ï¼Œè¿™æ˜¯çº¦å®šä¿—æˆçš„å‘½åã€‚å‡è®¾æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `countStore.ts` æ–‡ä»¶
   
   ```ts
   import { defineStore } from 'pinia'
   /*
   defineStore æ˜¯ Pinia åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå®šä¹‰ä¸€ä¸ªçŠ¶æ€å­˜å‚¨ï¼ˆstoreï¼‰ã€‚è¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š
   [name]ï¼šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œç”¨ä½œè¯¥ store çš„å”¯ä¸€ idã€‚
   [options]ï¼šä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº† store çš„é…ç½®é¡¹ï¼Œæ¯”å¦‚ stateï¼ˆçŠ¶æ€ï¼‰ï¼Œgettersï¼ˆè·å–å™¨ï¼‰ï¼Œactionsï¼ˆåŠ¨ä½œï¼‰ç­‰ã€‚
   */
   export const useCountStore = defineStore('count', {
     // åŠ¨ä½œæ–¹æ³•
     // è¿™ç§æ–¹å¼çš„ä¼˜åŠ¿,æ˜¯å¯ç»Ÿä¸€å¢åŠ æ‰§è¡Œé€»è¾‘,æ–¹ä¾¿å¤ç”¨
     actions: {
       // å¢åŠ sumçš„å€¼ï¼Œå½“sum>=10æ—¶ï¼Œåœæ­¢ã€‚
       increment(value: number) {
         if (this.sum < 10) {
           this.sum += value
         }
       }
     },
     // çœŸæ­£å­˜å‚¨æ•°æ®çš„åœ°æ–¹
     state() {
       return {
         sum: 0
       }
     },
     // è·å–å™¨
     getters: {
       bigSum(): number {
         return this.sum * 10
       }
     }
   })
   ```

4. **ä½¿ç”¨PiniaçŠ¶æ€**ï¼šåœ¨ä½ çš„vueæ–‡ä»¶ä¸­ `<script></script>` å°è¯•å¦‚ä¸‹ï¼š
   
   ```ts
   // å¯¼å…¥countStroe.ts
   import { useCountStore } from '@/store/countStore'
   // å¯¼å…¥storeToRefsï¼Œç”¨æ¥è·å–storeä¸­çš„å“åº”å¼å˜é‡
   import { storeToRefs } from 'pinia'
   // è·å–countStoreå¯¹è±¡
   const countStore = useCountStore()
   // è·å–å…¶ä¸­çš„å˜é‡ï¼Œè¯¥å˜é‡æ˜¯å“åº”å¼çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨
   const { sum, bigSum } = storeToRefs(countStore)
   // å®šä¹‰ä¸€ä¸ªaddæ–¹æ³•ï¼Œå±•ç¤ºä¿®æ”¹å˜é‡çš„3ç§æ–¹å¼
   function add() {
       // ç¬¬ä¸€ç§æ–¹å¼, ç®€å•ç²—æš´æ–¹å¼
       // countStore.sum += 1
   
       // ç¬¬äºŒç§æ–¹å¼, å¥½å¤„æ˜¯å¯ä»¥ä¸€æ¬¡æ€§æ‰¹é‡ä¿®æ”¹
       // countStore.$patch({
       //     sum: countStore.sum += 1
       // })
   
       // ç¬¬ä¸‰ç§æ–¹å¼actions, å°è£…å¯å¤ç”¨é€»è¾‘æ–¹å¼
       countStore.increment(1)
   }
   ```
